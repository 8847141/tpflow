<link rel="stylesheet" type="text/css" href="/static/work/workflow.4.0.css"/>
<div class="page-container" style='width:98%'>
<form action="{:url($int_url.'/wf/do_check_save')}" method="post" name="form" id="wfform">

<input type="hidden" value="{$flowinfo.flow_process}" name="flow_process">
{if condition='$flowinfo.status.wf_mode != 2'}
<input type="hidden" value="{$flowinfo['nexprocess']['id']}" name="npid">
{else/}
<input type="hidden" value="{$flowinfo.process.process_to}" name="npid">
{/if}
<input type="hidden" value="{$flowinfo.run_id}" name="run_id"><!--运行步骤-->
<input type="hidden" value="{$flowinfo.wf_mode}" name="wf_mode"><!--运行模式-->
<input type="hidden" value="{$_GET['sup'] ?? ''}" name="sup"><!--超级接口-->
<input id='submit_to_save' name='submit_to_save' value='' type='hidden'><!--审核模式-->
<input type="hidden" value="{$flowinfo.run_process}" name="run_process"><!--当前运行步骤的ID-->
<input id='upload' name='art' value='' type='hidden'>
		<table class="table table-border table-bordered table-bg" style='width:98%'>
			<thead>
			<tr>
			<th style='width:38%' class='text-c'>单据审批</th>
			<th style='width:59%' class='text-c'>审批记录</th>
			</tr>
			<tr>
			</thead>
			<td style='height:80px'>
				<table class="table table-border table-bordered table-bg">
				<tr>
				<td style='width:30px'>
				{if condition='$flowinfo.sing_st == 0'}审批{else/}会签{/if}意见</td>
				<td><textarea name='check_con'  datatype="*" style="width:100%;height:55px;"></textarea> </td>
				</tr>
				<tr id='nex_process'>
				<td style='width:30px' >下一步骤</td>
				<td>
					{$flowinfo.npi|raw}
				</td>
				</tr>
				<tr>
				<td colspan=2 class='text-c'>
				
				{if condition='$flowinfo.sing_st == 0'}
					<a class="button" id='nexbton' onclick='Tpflow.check_post("ok")' >提交</a> 
					{if condition='$flowinfo.status.is_back != 2'}
					<a class="button" id='backbton' onclick='tpflow_back()'value='back' >回退</a> 
					{/if}
					{if condition='$flowinfo.status.is_sing != 2'}
					<a class="button" id='singbton' onclick='tpflow_sing_send("sing")' >会签</a>
					{/if}
					<a class="button" id='bupload'onclick="Tpflow.lopen('上传','{:url($int_url.'/wf/wfup', ['id' => 'upload'])}','180','180')">附件</a> 
				{else/}
					<a class="button" id='nexbton' onclick='Tpflow.sing_post("sok")'>会签提交</a> 
					<a class="button" id='backbton' onclick='Tpflow.sing_post("sback")'>会签回退</a> 
					<a class="button" id='singbton' onclick='tpflow_sing_send("ssing")'>再会签</a>
				{/if}
				</td>
				</tr>
				</table>
			</td>
			<td valign="top" >
				<div style='width:98%;overflow-y:scroll; height:200px'>
					{:\\tpflow\\Api::wflogs($info.wf_fid,$info.wf_type);}
				</div>
			</td>
			</tr>
		</table>
</form>		
		<table class="table table-border table-bordered mt-20" style='width:98%'>
		<tr><td>
		<div id='bill_data'style='width:100%;overflow-y:scroll; height:200px'></div>
		
		</td></tr>
		</table>
</div>
<script type="text/javascript" src="__Flow__/jquery-1.7.2.min.js" ></script>
<script type="text/javascript" src="__Flow__/lib/layer/2.4/layer.js" ></script>
<script type="text/javascript" src="__Flow__/workflow.4.0.js" ></script>
<script type="text/javascript" src="__Flow__/lib/Validform/5.3.2/Validform.min.js" ></script>
<script type="text/javascript">
$(function(){
$("#wfform").Validform({
		tiptype:function(msg,o,cssctl){
			if (o.type == 3){
				layer.msg(msg, {time: 800}); 
			}
		},
		ajaxPost:true,
		showAllError:true,
		callback:function(ret){
			Tpflow.common_return(ret);
		}
	});	
	//$("#bill_data").load('{:url($int_url.'/'.$info.wf_type.'/'.$flowinfo.status.wf_action,['id'=>$info.wf_fid])}');
});
function tpflow_back(){
	Tpflow.lopen('工作流回退','{$info.tpflow_back}',500,300);
}
function tpflow_sing_send(ssing){
	Tpflow.lopen('工作流会签','{$info.tpflow_sign}&ssing='+ssing,500,300);
}

</script>
</body>
</html>